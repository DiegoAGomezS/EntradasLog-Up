<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Respaldo de Entradas – RNF-03</title>
    <style>
        body{
            font-family: Arial;
            background:#f4f4f4;
            padding:30px;
        }
        .container{
            background:white;
            width:450px;
            padding:20px;
            margin:auto;
            border-radius:8px;
            box-shadow:0 2px 8px rgba(0,0,0,.2);
        }
        label{font-weight:bold;}
        input{
            margin-bottom:12px;
        }
        button{
            padding:10px 18px;
            border:none;
            background:#6c63ff;
            color:white;
            border-radius:5px;
            cursor:pointer;
            margin-right:6px;
        }
        .error{
            background:#f8d7da;
            padding:10px;
            border-left:5px solid #a30000;
            margin-bottom:12px;
        }
        .success{
            background:#d4edda;
            padding:10px;
            border-left:5px solid #0f6b27;
            margin-bottom:12px;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Respaldo de Entradas</h2>

    <div id="msg"></div>

    <p><strong>Registros actuales:</strong> <span id="cantidadRegistros">0</span></p>

    <div style="margin-top:15px;">
        <button onclick="generarRespaldo()">Generar Respaldo</button>

        <input type="file" id="archivoRespaldo" accept=".json">
        <button onclick="restaurarRespaldo()">Restaurar</button>
    </div>

</div>

<script>
    function mostrarMensaje(texto, tipo){
        const msg = document.getElementById("msg");
        msg.innerHTML = `<div class="${tipo}">${texto}</div>`;
    }

    function actualizarCantidad(){
        let registros = JSON.parse(localStorage.getItem("registrosFinancieros")) || [];
        document.getElementById("cantidadRegistros").innerText = registros.length;
    }

    actualizarCantidad();

    function generarRespaldo(){
        let registros = JSON.parse(localStorage.getItem("registrosFinancieros")) || [];

        if(registros.length === 0){
            mostrarMensaje("No hay registros para respaldar.", "error");
            return;
        }

        const blob = new Blob([JSON.stringify(registros, null, 2)], {type: "application/json"});
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = `RespaldoFinanciero_${Date.now()}.json`;
        a.click();

        mostrarMensaje("Respaldo generado correctamente.", "success");
    }

    function restaurarRespaldo(){
        const archivo = document.getElementById("archivoRespaldo").files[0];

        if(!archivo){
            mostrarMensaje("Debe seleccionar un archivo JSON de respaldo.", "error");
            return;
        }

        const lector = new FileReader();

        lector.onload = function(e){
            try {
                const json = JSON.parse(e.target.result);

                if(!Array.isArray(json)){
                    mostrarMensaje("El archivo no tiene un formato válido.", "error");
                    return;
                }

                localStorage.setItem("registrosFinancieros", JSON.stringify(json));
                actualizarCantidad();
                mostrarMensaje("Respaldo restaurado correctamente.", "success");

            } catch (err) {
                mostrarMensaje("Error al leer el archivo. Formato inválido.", "error");
            }
        };

        lector.readAsText(archivo);
    }
</script>

</body>
</html>
